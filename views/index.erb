<ul id="manuscript"></ul>

<input type="text" name="message" id="message" placeholder="Say something..." required="required" />


<div pub-key="pub-32d1b09f-63b7-4015-8e59-bd603a2ec66e" sub-key="sub-7e2e745c-c38c-11e0-a0a5-53ec83638759" ssl="off" origin="pubsub.pubnub.com" id="pubnub"></div>
<script src="http://cdn.pubnub.com/pubnub-3.1.min.js"></script>
<script>
	$(function(){
		var channel = "chatterbee-chatter";
		var manuscript = $("#manuscript");
		var message = $("#message");
	
		PUBNUB.subscribe({
		    channel  : channel,
		    callback : function(text) 
			{
				manuscript.append("<li>" + text + "</li>");
				scroll_to_bottom(manuscript);
			}
		});
		
		
		message.bind("keyup", function(e){
			var code = (e.keyCode ? e.keyCode : e.which);
			
			if(code == 13)
			{
				PUBNUB.publish({
			        channel : channel, 
					message : message.val()
			    });
			
				message.val("");
			}
		});
		
		
		window.onbeforeunload = function()
		{
			$.get("/leave/<%= @connection %>");
		}
		
		
		function scroll_to_bottom(elem)
		{
			elem.animate({ scrollTop: elem.prop("scrollHeight") }, 1000);
		}

	});
	
	
	
</script>